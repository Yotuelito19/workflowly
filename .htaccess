# WorkFlowly - Configuración Apache
# .htaccess en la raíz del proyecto

# Habilitar RewriteEngine
RewriteEngine On

# Definir la base URL (ajustar según tu instalación)
RewriteBase /workflowly/

# RewriteCond %{HTTPS} off
# RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Bloquear acceso directo a carpetas sensibles
RedirectMatch 403 ^/workflowly/app/.*$
RedirectMatch 403 ^/workflowly/config/.*$
RedirectMatch 403 ^/workflowly/database/.*$
RedirectMatch 403 ^/workflowly/logs/.*$

# Permitir acceso a public
<IfModule mod_rewrite.c>
    # Si se accede a la raíz sin archivo, redirigir a public/index.php
    RewriteRule ^$ public/index.php [L]
</IfModule>

# Evitar listado de directorios
Options -Indexes

# Configuración de charset por defecto
AddDefaultCharset UTF-8

# Tipos MIME
AddType application/javascript .js
AddType text/css .css

# Habilitar compresión GZIP
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

# Configurar tiempo de caché para recursos estáticos
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/pdf "access plus 1 month"
    ExpiresByType text/javascript "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType application/x-shockwave-flash "access plus 1 month"
    ExpiresByType image/x-icon "access plus 1 year"
    ExpiresDefault "access plus 2 days"
</IfModule>

# Proteger archivos sensibles
<FilesMatch "\.(htaccess|htpasswd|ini|log|sql|md)$">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# Configuración de errores personalizados (opcional)
# ErrorDocument 404 /workflowly/public/404.php
# ErrorDocument 403 /workflowly/public/403.php
# ErrorDocument 500 /workflowly/public/500.php

# Desactivar firma del servidor
ServerSignature Off

# Límite de tamaño de subida (ajustar según necesidad)
php_value upload_max_filesize 10M
php_value post_max_size 10M
php_value max_execution_time 300
php_value max_input_time 300

# Configuración de sesiones PHP
php_value session.cookie_httponly 1
php_value session.cookie_secure 0
php_value session.use_only_cookies 1

# Deshabilitar display_errors en producción
php_flag display_errors Off
php_value error_reporting 0

# Log de errores PHP
php_flag log_errors On
php_value error_log logs/php_errors.log
